<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>购物车</title>
    <style>
    	*{padding: 0;margin: 0;}
    	html{
    		font-size: 1rem;
    	}
    </style>
    <script type="text/javascript">
    	
   		document.addEventListener('plusready', function(){
   			//console.log("所有plus api都应该在此事件发生后调用，否则会出现plus is undefined。"
   			
   		});
   		window.onload = function(){
   			
	   		//1.显示你已经添加进来的数据
	   		var shopList=[
	   		{goodsId:"10023",goodsName:"尿不湿",price:"0.001",count:"1"},
	   		{goodsId:"10024",goodsName:"健力宝",price:"0.001",count:"1"},
	   		{goodsId:"10025",goodsName:"白加黑",price:"0.001",count:"1"},
	   		{goodsId:"10026",goodsName:"啤酒",price:"0.001",count:"1"},
	   		{goodsId:"10027",goodsName:"脑白金",price:"0.001",count:"1"}
	   		];
	   		
	   		var str = "";
	   		for(var i=0;i<shopList.length;i++){
	   			str += '<div style="width:100%;height:5rem;'+
					'border-bottom: 2px solid #acacac;text-align: center;'+
					'letter-spacing:3px;line-height:5rem;">'+
					'<span>商品名称:<span>'+ shopList[i].goodsName+'</span></span>'+
					'<span>||商品价格:<span class="price">'+ shopList[i].price+'</span></span>'+
					'<span>||商品数量:<span>'+ shopList[i].count+'</span></span>'+
				'</div>'
	   		}
	   		document.getElementById("list").innerHTML = str;
	   		
	   		document.getElementById("payMoney").onclick = function(){
	   		//2.开始结算(js来进行结算)
	   			var _allprice = document.getElementsByClassName('price');
	   			console.log(_allprice);
	   			var total=0;
	   			for(var i=0;i<_allprice.length;i++){
	   				total +=parseFloat(_allprice[i].innerHTML);
	   			}
	   			console.log(total);
	   		//3.确定并付款
	   		var payHttp =  "http://demo.dcloud.net.cn/helloh5/payment/alipay.php?total="+total*10;
    		
    		var _payment = plus.payment;
    		_payment.getChannels(function(channels){
    			//alert(JSON.stringify(channels));//[{id:"alipay"},{id:"wxpay"}];
    			
    			for(var i=0;i<channels.length;i++){
    				if(channels[i].id == "wxpay"){
    					
    				}else{
    					//支付宝支付;
    					var _channels = channels[i];
    					//alert("执行支付宝进行支付");
    					var xhr = new XMLHttpRequest();
    					xhr.open("GET",payHttp);
    					xhr.onreadystatechange = function(){
    						if(xhr.readyState == 4){
    							if(xhr.status == 200){
    								plus.payment.request(_channels,xhr.responseText,function(){
    									alert("您支付成功,谢谢土豪哥!");
    								});
    							}
    						}
    					};
    					xhr.send("");
    				}
    			}
    		},function(error){
    			alert("您的手机没有任何一款支付软件:"+error.message);
    		})
	   		}
	   		
   		}
   		
    </script>
</head>
<body>
	<div>
		<header style="width:100%;height:2.5rem;overflow: hidden;
			background-color:#0087dc;text-align: center;">
			<h3 style="line-height: 2.5rem;color: #fafafa;">商品列表</h3>
		</header>
		<div  id="list" style="width:100%;min-height: 16rem;">
			<div style="width:100%;height:5rem;
				border-bottom: 2px solid #acacac;text-align: center;
				letter-spacing:3px;line-height:5rem;">
				<span>商品名称<span></span></span>
				<span>商品价格<span></span></span>
				<span>商品数量<span></span></span>
			</div>
			<div style="width:100%;height:5rem;border-bottom: 2px solid #acacac;">
				
			</div>
		</div>
		<div style="width:100%;height: 4rem;overflow: hidden;text-align: center;">
			<div id="payMoney" style="width:200px;height:46px;border-radius: 4px;
				background-color: #0087dc;text-align: center;margin:0 auto;
				line-height:46px;color:#fafafa">
			            确认并付款
			</div>
		</div>
	</div>
</body>
</html>
